version: '1.0'
steps: 
    build-step:
        description: Building the image.
        title: Build the Docker image...
        type: build
        dockerfile: Dockerfile
        image-name: aloncodefresh/demochat
        tag: codefresh
    freestyle-step:
        description: Freestyle step..
        title: Free styling
        image: nhoag/curl
        commands:
          - echo "step 1"
          - echo "Path is $PATH"
          - echo /usr/local/sbin is
          - ls -l /usr/local/sbin
          - echo /usr/local/bin is
          - ls -l /usr/local/bin
          - echo /usr/sbin is
          - ls -l /usr/sbin
          - echo /usr/bin is
          - ls -l /usr/bin
          - echo /sbin is 
          - ls -l /sbin
          - echo /bin is
          - ls -l /bin
          - echo Volume is
          - ls -l /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/cf_export IS
          - cat /codefresh/volume/cf_export
          - echo ---------------------------- END          
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - export EXPORTED=EXPVAL
          - EXPORTED=EXPVAL echo Exported is $EXPORTED
          - echo CF_BRANCH is $CF_BRANCH 
          - EXPORTED=EXPVAL cf_export SOME=VALUE1 EXPORTED CF_BRANCH
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
    freestyle-step2:
        description: Freestyle step 2..
        title: Free styling 2
        image: nhoag/curl
        commands:
          - echo "Step 2"
          - echo "Path is $PATH"
          - ls /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - echo ANOTHER=VALUE2 >> /codefresh/volume/env_vars_to_export
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END          
    freestyle-step3:
        description: Freestyle step 3..
        title: Free styling 3
        image: nhoag/curl
        commands:
          - echo "Step 3"
          - echo "Path is $PATH"
          - ls /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - cf_export LAST=VALUE3
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END        
    freestyle-step4:
        description: Freestyle step 4..
        title: Free styling 4
        image: alpine:latest
        commands:
          - echo "step 4"
          - echo "Path is $PATH"          
          - ls /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/cf_export IS
          - cat /codefresh/volume/cf_export
          - echo ---------------------------- END          
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - export EXPORTED2=EXPVAL
          - EXPORTED2=EXPVAL echo Exported2 is $EXPORTED2
          - echo CF_BRANCH is $CF_BRANCH 
          - EXPORTED2=EXPVAL2 cf_export SOME2=VALUE1 EXPORTED2 CF_BRANCH
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
    freestyle-step5:
        description: Freestyle step 5..
        title: Free styling 5
        image: alpine:latest
        commands:
          - echo "Step 5"
          - echo "Path is $PATH"          
          - ls /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - echo ANOTHER2=VALUE2 >> /codefresh/volume/env_vars_to_export
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END          
    freestyle-step6:
        description: Freestyle step 6..
        title: Free styling 66
        image: alpine:latest
        commands:
          - echo "Step 6"
          - echo "Path is $PATH"          
          - ls /codefresh/volume
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END
          - cf_export LAST2=VALUE3
          - echo ---------------------------- START
          - echo /codefresh/volume/env_vars_to_export IS AFTER
          - cat /codefresh/volume/env_vars_to_export
          - echo ---------------------------- END                
    composition-step:
      title: Running as a composition...
      description: Attempting to run as part of composition.
      type: composition
      composition: 
        version: '2'
        services:
          app:
            image: nhoag/curl
            environment:
              - echo ANOTHER is ${{ANOTHER}} and also ${ANOTHER} and also $ANOTHER
              - echo ANOTHER2 is ${{ANOTHER2}} and also ${ANOTHER2} and also $ANOTHER2
          app2:
            image: nhoag/curl
            environment:
              - echo SOME is ${{SOME}}  
              - echo SOME2 is ${{SOME2}}                            
      composition-candidates:
        main:
          image: nhoag/curl
          command: bash -c "sleep 20" | echo 'works'
