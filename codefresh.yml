version: '1.0'
steps:
    build-step:
        description: Building the image.
        title: Build the Docker image...
        type: build
        dockerfile: Dockerfile
        image-name: aloncodefresh/demochat
        tag: codefresh
        
    integration_test1:
      type: integration-test
      services: [ redis, postgresql, mongodb, mysql, couchdb, rabbitmq, memcached ]
      test:
        image: redis:latest
        commands: 
          - sleep 30
          - redis-cli -h redis
    
    integration_test2:
      type: integration-test
      containers: 
        redis:
          image: redis
          ports:
            - 6379
      test:
        image: redis:latest
        commands: 
          - echo sleeping 30
          - sleep 30
          - echo testing
          - redis-cli -h redis
          - echo done
    
    integration_test3:
      type: integration-test
      services: [  postgresql, mongodb, mysql, couchdb, rabbitmq, memcached ]
      containers: 
        redis:
          image: redis
          ports:
            - 6379
      test:
        image: redis:latest
        commands: 
          - echo sleeping 30
          - sleep 30
          - echo testing
          - redis-cli -h redis
          - echo done
