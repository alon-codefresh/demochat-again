version: '1.0'
steps:
  SetupTestComposition:
    type: composition
    title: Setup Test Composition
    composition:
      version: '2'
      services:
        postgres:
          restart: always
          image: 'postgres:latest'
          ports:
            - '5432'
          volumes:
            - '${{CF_VOLUME}}:/var/lib/postgres/data'
          environment:
            - POSTGRES_DB=testdb
      volumes:
        '${{CF_VOLUME}}':
          external: true
    working_directory: '${{main_clone}}'
    composition_candidates:
      test:
        image: redis:latest
        volumes:
          - '${{CF_VOLUME_NAME}}:/cf_volume'
        command: |
          sh -c ' ls -l '
        environment:
          - API_SERVICE=web
          - API_PORT=3000
        depends_on:
          - postgres

