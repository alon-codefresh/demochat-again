version: '1.0'
steps:
    build-step:
        description: Building the image.
        title: Build the Docker image...
        type: build
        dockerfile: Dockerfile
        image-name: aloncodefresh/demochat
        tag: codefresh
        
    integration_test1:
      type: integration-test
      preconfigured_services: [ redis, postgresql, mongodb, mysql, couchdb, rabbitmq, memcached ]
      test:
        image: nhoag/curl
        commands: 
          - curl www.google.com
    
    integration_test2:
      type: integration-test
      services: 
        redis:
          image: redis
          ports:
            - 6379
      test:
        image: nhoag/curl
        commands: 
          - echo sleeping 30
          - sleep 30
          - echo testing
          - echo "I would have run redis-cli -h redis right about now"
          - echo done
    
    integration_test3:
      type: integration-test
      preconfigured_services: [  postgresql, mongodb, mysql, couchdb, rabbitmq, memcached ]
      services: 
        redis:
          image: redis
          ports:
            - 6379
      test:
        image: redis:latest
        commands: 
          - echo sleeping 30
          - sleep 30
          - echo "I am going to fail since redis:latest has no bash in it, and these commadns are chained as a single bash command"
          - echo "I would have run redis-cli -h redis right about now"
          - echo done
