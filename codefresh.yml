version: '1.0'
steps:
    build-step:
        description: Building the image.
        title: Build the Docker image...
        type: build
        dockerfile: Dockerfile
        image-name: aloncodefresh/demochat
        tag: codefresh
    freestyle-step:
        description: Freestyle step..
        title: Free styling
        image: nhoag/curl
        commands:
          - "ls"
          - "echo this1: $SOME_VAR"
          - "echo this2: ${SOME_VAR}"
          - "echo this3: ${{SOME_VAR}}"
          - ls -l
          - ls -a         
    composition-step:
      title: Running as a composition...
      description: Attempting to run as part of composition.
      type: composition
      composition: 
        version: '2'
        services:
          app:
            image: 'aloncodefresh/demochat:master'
            ports:
              - 5000
            depends_on:
              - mongo
          mongo:
            image: mongo
      composition-candidates:
        main:
          image: nhoag/curl
          command: bash -c "sleep 20 && curl http://app:5000/" | echo 'works'
    push-step:
        description: Pushing image to Docker hub.
        type: push
        candidate: ${{build-step}}
        tag: ${{CF_BRANCH}}        
